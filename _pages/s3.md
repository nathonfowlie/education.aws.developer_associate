---
title: "S3"
header:
  image: "/assets/images/aws_developer_associate_teaser.jpg"
permalink: /s3/
sidebar:
  nav: "docs"
toc: true
toc_icon: "book-reader"
toc_label: "Table of Contents"
---

## Overview

- Global service.
- Consists of buckets and objects.

## Buckets

- Allows files (objects) to be storeid.
- Have a globally unique name.
- Each bucket sits in a region, even though S3 is a global service.
- Public access is blocked by default.

### Naming Convention

Bucket names must follow a naming convention -

- No uppercase
- No underscore
- 3-63 chars
- Not an IP
- Must start with a lowercase letter or number.

## S3 Objects

- Have a key (full path to the file, excluding the bucket name ie: my_file.txt, /path/to/my_file.txt).
- Prefix is the file path (/path/to/file).
- Object name is the file name (my_file.txt).
- Object value is the file contents.
- Max object size is 5TB.
- Max upload size at any time is 5GB. Larger than that must use multi-part uploads.
- Have key-value pair metadata.
- Can be tagged.
- Have a version id if versioning is enabled.
- Each object can have ACLs, be encrypted, assigned a storage class etc.
- Can have a pre-signed URL.

### Versioning

- Enabled at the bucket level.
- Each time the same key is over-written, it will be given a new version.
- Files not versioned prior to enabling versioning will have the version "null".
- Suspending versioning does not delete the previous versions.
- Delete marker is created when a file is deleted. Old versions of the file will remain accessible.
- Deleting the delete marker, will result in the latest version of the file being restored.

### Encryption

There's four ways to encrypt objects, and it's possible to define a default encryption method for a bucket.

| Method                 | Description                                                                  |
|------------------------|------------------------------------------------------------------------------|
| SS3-S3                 | Use keys handled and managed by AWS.                                         |
| SSE-KMS                | Use AWS KMS to manage encryption keys.                                       |
| SSE-C                  | Manage your own encryption keys.                                             |
| Client Side Encryption | Customer fully managed the encryption/decryption process on the client side. |

#### SSE-S3

- Encryption keys managed by AWS S3.
- Server-side encryption.
- Uses AES-256.
- Must add the header **"x-amz-server-side-encryption": "AES256"**.

#### SSE-KMS

- Use AWS KMS to manage encryption keys.
- Provides control over who has access to the keys, plus an audit trail.
- Server-side encryption.
- Uses the Customer Master Key (CMK) to encrypt the object.
- Must add the header **"x-amz-server-side-encryption": "aws:kms"**.

#### SSE-C

- Uses Client side data key provided by the user (outside of AWS).
- Server-side encryption.
- Key is not stored by S3.
- Must use HTTPS.
- Encryption key needs to be in the HTTP header.

#### Client Side Encryption

- Customer fully controls the encryption/decryption cycle.
- Object encrypted prior to upload.
- S3 Encryption Client library can help do this.
- Clients must encrypt/decrypt the object themselves.

### Encryption in Transit (TLS/SS)

- S3 endpoints can be utilized using HTTP, or HTTPS.

## S3 Security

### User Based

- Security defined by IAM policies: These control which API calls are allowed for a specific user, and are defined in the IAM console.
- IAM principal can acces an S3 object if:
  - The users IAM permissions allow it, or the resource policy allows it.
  - There's no explicit DENY on the bucket policy.

### Resource Based


- Object Access Control List (ACL): Applies to the whole bucket, but allows ACLs to be defined at the object level.
- Bucket Access Control List (ACL): Applies to the whole bucket, less commonly used.

#### Bucket Policy

- Applies to the whole bucket.
- Rules are defined in the S3 console, which allows cross-account access.
- Defined in JSON.
- Can be applied to bucket and objects.
- General structure:

        {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Sid": "PublicRead",
                    "Effect": "Allow",
                    "Principal": "*",
                    "Action": [
                        "s3:GetObject"
                    ],
                    "Resource": [
                        "arn:aws:s3:::mybucket/*"
                    ]
                }
            ]
        }

- Blocking public access to buckets and objects can be done through:
  - *new* Access Control Lists (ACLs)
  - *any* Access Control Lists (ACLs)
  - *new* public bucket or access point policies
- Blocking public and cross-account access to buckets and objects can be done through:
  - *any* public bucket or access point policy.
- Blocking public access to buckets can be set at the account level.

### Networking

- VPC endpoint to access buckets privately within a VPC.

### Logging & Auditing

- S3 access logs can be stored in another S3 bucket.
- CloudTrail to log API calls.

### User Security

- MFA can be required in versioned buckets to delete objects.
- Pre-signed URLs that are signed with AWS credentials and are only available for a limited amount of time.

## S3 Static Websites

- <bucket name>.s3-website-<region>.amazonaws.com
- Bucket needs to be public, and have a S3 policy that allows public reads, otherwise you'll get a 403 error.
- Bucket objects need to be un-encrypted.
- Can set a custom index and error page.
- Can define redirection rules.


### CORS

- Origin is a scheme, host and port (https:// on port 443 etc).
- Allows the website to make requests to other origins than have been white-listed.
- Uses the Access-Control-Allow-Origin header to control what origins are permitted to access web resources.

### S3 CORS

- Can allow for a specific origin via an explicit name, or use "*" to allow all origins.
- CORS headers must be enabled on the cross-origin bucket, to allow a client to do a cross-origin request.


## Consistency Model

- Read after write consistency for PUTS of new objects.
- Eventually consistent for DELETEs and PUTS of existing objects.
- There is no way to request strong consistency.
